{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - ChatBot</title>
    <link rel="stylesheet" href="{% static 'chat/auth.css' %}" />
  </head>
  <body>
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="bot-avatar large">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM8 17C7.45 17 7 16.55 7 16C7 15.45 7.45 15 8 15C8.55 15 9 15.45 9 16C9 16.55 8.55 17 8 17ZM9 13C9 13.55 8.55 14 8 14C7.45 14 7 13.55 7 13V9C7 8.45 7.45 8 8 8C8.55 8 9 8.45 9 9V13ZM12 18C10.9 18 10 17.1 10 16H14C14 17.1 13.1 18 12 18ZM16 14C15.45 14 15 13.55 15 13V9C15 8.45 15.45 8 16 8C16.55 8 17 8.45 17 9V13C17 13.55 16.55 14 16 14Z"
                fill="currentColor"
              />
            </svg>
          </div>
          <h2>Welcome Back</h2>
          <p>Sign in to continue to ChatBot</p>
        </div>

        <div id="notification" class="notification hidden"></div>

        <form method="post" class="auth-form" id="login-form">
          {% csrf_token %}
          <div class="form-group">
            <input
              type="text"
              name="username"
              placeholder="Username"
              required
              autocomplete="username"
            />
            <div class="error-message" id="username-error"></div>
          </div>
          <div class="form-group password-field">
            <input
              type="password"
              name="password"
              id="password-input"
              placeholder="Password"
              required
              autocomplete="current-password"
            />
            <button type="button" class="toggle-password" id="toggle-password">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 9C11.2044 9 10.4413 9.31607 9.87868 9.87868C9.31607 10.4413 9 11.2044 9 12C9 12.7956 9.31607 13.5587 9.87868 14.1213C10.4413 14.6839 11.2044 15 12 15C12.7956 15 13.5587 14.6839 14.1213 14.1213C14.6839 13.5587 15 12.7956 15 12C15 11.2044 14.6839 10.4413 14.1213 9.87868C13.5587 9.31607 12.7956 9 12 9Z" fill="currentColor"/>
                <path d="M21.87 11.5C21.23 10.39 17.71 4.82 12 4.82C6.29 4.82 2.77 10.39 2.13 11.5C1.95 11.81 1.95 12.19 2.13 12.5C2.77 13.61 6.29 19.18 12 19.18C17.71 19.18 21.23 13.61 21.87 12.5C22.05 12.19 22.05 11.81 21.87 11.5ZM12 16.5C9.51472 16.5 7.5 14.4853 7.5 12C7.5 9.51472 9.51472 7.5 12 7.5C14.4853 7.5 16.5 9.51472 16.5 12C16.5 14.4853 14.4853 16.5 12 16.5Z" fill="currentColor"/>
              </svg>
            </button>
            <div class="error-message" id="password-error"></div>
          </div>
          <div class="form-options">
            <label class="checkbox-container">
              <input type="checkbox" name="remember_me" />
              <span class="checkmark"></span>
              Remember me
            </label>
            <a href="/forgot-password/" class="forgot-password">Forgot Password?</a>
          </div>
          <button type="submit" class="auth-btn" id="login-btn">
            <span class="btn-text">Sign In</span>
            <div class="btn-loader hidden"></div>
          </button>
        </form>

        <div class="auth-footer">
          <p>Don't have an account? <a href="/signup/">Sign Up</a></p>
        </div>
      </div>
    </div>

    <script>
      document.getElementById("login-form").addEventListener("submit", function (e) {
        e.preventDefault();
        submitLoginForm();
      });

      document.getElementById("toggle-password").addEventListener("click", function() {
        const passwordInput = document.getElementById("password-input");
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          this.innerHTML = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.83 9L15 12.16V12C15 11.45 14.55 11 14 11H11.83L13.83 13H14C15.1 13 16 13.9 16 15C16 15.35 15.94 15.69 15.83 16L17.83 18C18.69 17.11 19.25 16 19.45 15.46C19.66 14.9 19.66 14.1 19.45 13.54C19.02 12.39 17.8 10.58 16 9.25V9C16 6.94 14.36 5.22 12.33 5.02C12.13 5 12.06 5 12 5C11.94 5 11.87 5 11.67 5.02C11.5 5.03 11.33 5.06 11.17 5.09L12.83 6.75C12.56 6.73 12.28 6.71 12 6.71C9.67 6.71 7.46 8.59 6.55 11.5C6.34 12.06 6.34 12.94 6.55 13.5C6.76 14.06 7.19 15 7.83 15.83L9.23 17.23C8.45 16.38 7.87 15.37 7.55 14.46C7.34 13.9 7.34 13.1 7.55 12.54C8.38 10.18 10.54 8.5 12 8.5C12.28 8.5 12.56 8.54 12.83 8.61L11.83 9Z" fill="currentColor"/><path d="M1.39 4.22L3.17 6H3C2.45 6 2 6.45 2 7V17C2 17.55 2.45 18 3 18H15.17L17.17 20H3C1.9 20 1 19.1 1 18V7C1 6.9 1.04 6.8 1.06 6.7L1.11 6.56L1.39 4.22Z" fill="currentColor"/><path d="M22.61 20.61L21.39 19.39L3.61 1.61L2.39 2.81L5.11 5.53C5.04 5.68 5 5.83 5 6V18C5 18.55 5.45 19 6 19H20C20.05 19 20.1 19 20.15 18.99L22.61 21.45L23.83 20.23L22.61 20.61ZM8.17 11L12.17 15H12C11.45 15 11 14.55 11 14V13.83L8.17 11ZM9.17 13L11 14.83V15H9.17V13ZM15.17 18H7V7.83L6.17 7H6V6.83L4.83 5.66C4.41 6.08 4.06 6.55 3.75 7.04C3.54 7.46 3.54 8.1 3.75 8.54C4.46 10.01 5.78 11.5 7 12.17V14C7 15.1 7.9 16 9 16H14.17L15.17 17V18Z" fill="currentColor"/></svg>';
        } else {
          passwordInput.type = "password";
          this.innerHTML = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 9C11.2044 9 10.4413 9.31607 9.87868 9.87868C9.31607 10.4413 9 11.2044 9 12C9 12.7956 9.31607 13.5587 9.87868 14.1213C10.4413 14.6839 11.2044 15 12 15C12.7956 15 13.5587 14.6839 14.1213 14.1213C14.6839 13.5587 15 12.7956 15 12C15 11.2044 14.6839 10.4413 14.1213 9.87868C13.5587 9.31607 12.7956 9 12 9Z" fill="currentColor"/><path d="M21.87 11.5C21.23 10.39 17.71 4.82 12 4.82C6.29 4.82 2.77 10.39 2.13 11.5C1.95 11.81 1.95 12.19 2.13 12.5C2.77 13.61 6.29 19.18 12 19.18C17.71 19.18 21.23 13.61 21.87 12.5C22.05 12.19 22.05 11.81 21.87 11.5ZM12 16.5C9.51472 16.5 7.5 14.4853 7.5 12C7.5 9.51472 9.51472 7.5 12 7.5C14.4853 7.5 16.5 9.51472 16.5 12C16.5 14.4853 14.4853 16.5 12 16.5Z" fill="currentColor"/></svg>';
        }
      });

      function showNotification(message, type = "error") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.remove("hidden");

        setTimeout(() => {
          notification.classList.add("hidden");
        }, 5000);
      }

      function submitLoginForm() {
        const form = document.getElementById("login-form");
        const formData = new FormData(form);
        const loginBtn = document.getElementById("login-btn");
        const btnText = loginBtn.querySelector(".btn-text");
        const btnLoader = loginBtn.querySelector(".btn-loader");

        document.querySelectorAll(".error-message").forEach((el) => {
          el.textContent = "";
        });

        btnText.classList.add("hidden");
        btnLoader.classList.remove("hidden");
        loginBtn.disabled = true;

        fetch("/login/", {
          method: "POST",
          body: formData,
          headers: {
            "X-Requested-With": "XMLHttpRequest",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showNotification("Login successful! Redirecting...", "success");
              setTimeout(() => {
                window.location.href = data.redirect;
              }, 1000);
            } else {
              if (data.errors) {
                for (const [field, error] of Object.entries(data.errors)) {
                  const errorElement = document.getElementById(
                    `${field}-error`
                  );
                  if (errorElement) {
                    errorElement.textContent = error;
                  } else {
                    showNotification(error);
                  }
                }
              }
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            showNotification("An error occurred. Please try again.");
          })
          .finally(() => {
            btnText.classList.remove("hidden");
            btnLoader.classList.add("hidden");
            loginBtn.disabled = false;
          });
      }
    </script>
  </body>
</html>