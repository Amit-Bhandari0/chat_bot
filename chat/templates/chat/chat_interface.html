{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatBot - Your Virtual Assistant</title>
    <link rel="stylesheet" href="{% static 'chat/chat_styles.css' %}" />
    <meta name="csrf-token" content="{{ csrf_token }}" />
  </head>
  <body>
    <div class="app-container">
      <div class="chat-container">
        <header class="chat-header">
          <div class="bot-info">
            <div class="bot-avatar">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM8 17C7.45 17 7 16.55 7 16C7 15.45 7.45 15 8 15C8.55 15 9 15.45 9 16C9 16.55 8.55 17 8 17ZM9 13C9 13.55 8.55 14 8 14C7.45 14 7 13.55 7 13V9C7 8.45 7.45 8 8 8C8.55 8 9 8.45 9 9V13ZM12 18C10.9 18 10 17.1 10 16H14C14 17.1 13.1 18 12 18ZM16 14C15.45 14 15 13.55 15 13V9C15 8.45 15.45 8 16 8C16.55 8 17 8.45 17 9V13C17 13.55 16.55 14 16 14Z"
                  fill="currentColor"
                />
              </svg>
            </div>
            <div class="bot-details">
              <span class="bot-name">ChatBot</span>
              <span class="bot-status"
                ><span class="status-dot"></span>Online</span
              >
            </div>
          </div>
          <div class="header-actions">
            {% if user.is_authenticated %}
            <div class="user-menu-container">
              <button class="menu-btn" id="user-menu-btn">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12 8C13.1 8 14 7.1 14 6C14 4.9 13.1 4 12 4C10.9 4 10 4.9 10 6C10 7.1 10.9 8 12 8ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10ZM12 16C10.9 16 10 16.9 10 18C10 19.1 10.9 20 12 20C13.1 20 14 19.1 14 18C14 16.9 13.1 16 12 16Z"
                    fill="currentColor"
                  />
                </svg>
              </button>
              <div class="user-menu" id="user-menu">
                <div class="user-profile">
                  <div class="user-avatar">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 5C13.66 5 15 6.34 15 8C15 9.66 13.66 11 12 11C10.34 11 9 9.66 9 8C9 6.34 10.34 5 12 5ZM12 19.2C9.5 19.2 7.29 17.92 6 15.98C6.03 13.99 10 12.9 12 12.9C13.99 12.9 17.97 13.99 18 15.98C16.71 17.92 14.5 19.2 12 19.2Z"
                        fill="currentColor"
                      />
                    </svg>
                  </div>
                  <div class="user-info">
                    <span class="user-name">{{ user.username }}</span>
                    <span class="user-email">{{ user.email }}</span>
                  </div>
                </div>
                <button class="menu-item" id="chat-history-btn">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M19 2H5C3.9 2 3 2.9 3 4V22L7 18H19C20.1 18 21 17.1 21 16V4C21 2.9 20.1 2 19 2ZM19 16H7L5 18V4H19V16Z"
                      fill="currentColor"
                    />
                  </svg>
                  <span>Chat History</span>
                </button>
                <div class="menu-divider"></div>
                <button class="menu-item" id="settings-menu-btn">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM7 7H9V9H7V7ZM7 11H9V13H7V11ZM7 15H9V17H7V15ZM17 17H11V15H17V17ZM17 13H11V11H17V13ZM17 9H11V7H17V9Z"
                      fill="currentColor"
                    />
                  </svg>
                  <span>Settings</span>
                </button>
                <div class="menu-divider"></div>
                <a href="/logout/" class="menu-item">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.59L17 17L22 12L17 7ZM4 5H12V7H4V19H12V21H4C2.9 21 2 20.1 2 19V7C2 5.9 2.9 5 4 5Z"
                      fill="currentColor"
                    />
                  </svg>
                  <span>Logout</span>
                </a>
              </div>
            </div>
            {% else %}
            <div class="auth-buttons">
              <a href="/login/" class="btn btn-outline">Sign In</a>
              <a href="/signup/" class="btn btn-primary">Sign Up</a>
            </div>
            {% endif %}
          </div>
        </header>

        <div class="chat-messages" id="chat-box">
          {% if not user.is_authenticated %}
          <div class="message bot">
            Hello! I'm ChatBot, your virtual assistant powered by Google Gemini. How can I help you today?
            <div class="login-prompt">
              <p>Please <a href="/login/">login</a> to start a conversation and save your chat history.</p>
            </div>
          </div>
          {% endif %}
        </div>

        {% if user.is_authenticated %}
        <div class="chat-input-container">
          <div class="input-wrapper">
            <input
              type="text"
              id="user-input"
              placeholder="Message ChatBot..."
            />
            <button id="send-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"
                  fill="currentColor"
                />
              </svg>
            </button>
          </div>
        </div>
        {% else %}
        <div class="chat-input-container login-prompt-container">
          <div class="login-prompt">
            <p>Please <a href="/login/">login</a> to chat with me</p>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    {% if user.is_authenticated %}
    <div class="modal" id="settings-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button class="close-btn" id="close-settings">&times;</button>
        </div>
        <div class="modal-body">
          <div class="settings-option" id="delete-account">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z"
                fill="currentColor"
              />
            </svg>
            <span>Delete Account</span>
          </div>
          <div class="settings-option">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"
                fill="currentColor"
              />
            </svg>
            <span>Change Theme</span>
            <div class="theme-options">
              <button class="theme-option" id="theme-light">Light</button>
              <button class="theme-option" id="theme-dark">Dark</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="delete-account-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Delete Account</h2>
          <button class="close-btn" id="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete your account? This action cannot be
            undone.
          </p>
          <div class="modal-actions">
            <button class="cancel-btn" id="cancel-delete">Cancel</button>
            <button class="delete-btn" id="confirm-delete">
              Delete Account
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="chat-history-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Chat History</h2>
          <button class="close-btn" id="close-chat-history">&times;</button>
        </div>
        <div class="modal-body">
          <div id="chat-history-content" class="chat-history-container">
            <div class="loading-spinner"></div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <script src="{% static 'chat/chat_script.js' %}"></script>
  </body>
</html>
